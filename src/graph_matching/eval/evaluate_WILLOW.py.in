#!/usr/bin/python
from subprocess import call
import os

options = "--roundingReparametrization uniform:0.5 --tightenReparametrization uniform:0.5 --tightenInterval 50 --tightenIteration 300 --tightenConstraintsPercentage 0.05  --mcfReparametrization --primalComputationStart 1 --primalComputationInterval 50 -v 2 --lowerBoundComputationInterval 10 --tighten --multigraphMatchingOutputFormat clustering"

algorithms = ['multigraph_matching', 'multigraph_matching_tightening']

WILLOW_instance_dir = "@WILLOW_INSTANCE_DIRECTORY@" + "/"

instance_list = [
   'gm_8/Face/instance_00001/instance.txt',
   'gm_8/Face/instance_00000/instance.txt',
   'gm_8/Face/instance_00009/instance.txt',
   'gm_8/Face/instance_00006/instance.txt',
   'gm_8/Face/instance_00005/instance.txt',
   'gm_8/Face/instance_00008/instance.txt',
   'gm_8/Face/instance_00004/instance.txt',
   'gm_8/Face/instance_00007/instance.txt',
   'gm_8/Face/instance_00003/instance.txt',
   'gm_8/Face/instance_00002/instance.txt',
   'gm_8/Winebottle/instance_00001/instance.txt',
   'gm_8/Winebottle/instance_00000/instance.txt',
   'gm_8/Winebottle/instance_00009/instance.txt',
   'gm_8/Winebottle/instance_00006/instance.txt',
   'gm_8/Winebottle/instance_00005/instance.txt',
   'gm_8/Winebottle/instance_00008/instance.txt',
   'gm_8/Winebottle/instance_00004/instance.txt',
   'gm_8/Winebottle/instance_00007/instance.txt',
   'gm_8/Winebottle/instance_00003/instance.txt',
   'gm_8/Winebottle/instance_00002/instance.txt',
   'gm_8/Motorbike/instance_00001/instance.txt',
   'gm_8/Motorbike/instance_00000/instance.txt',
   'gm_8/Motorbike/instance_00009/instance.txt',
   'gm_8/Motorbike/instance_00006/instance.txt',
   'gm_8/Motorbike/instance_00005/instance.txt',
   'gm_8/Motorbike/instance_00008/instance.txt',
   'gm_8/Motorbike/instance_00004/instance.txt',
   'gm_8/Motorbike/instance_00007/instance.txt',
   'gm_8/Motorbike/instance_00003/instance.txt',
   'gm_8/Motorbike/instance_00002/instance.txt',
   'gm_8/Car/instance_00001/instance.txt',
   'gm_8/Car/instance_00000/instance.txt',
   'gm_8/Car/instance_00009/instance.txt',
   'gm_8/Car/instance_00006/instance.txt',
   'gm_8/Car/instance_00005/instance.txt',
   'gm_8/Car/instance_00008/instance.txt',
   'gm_8/Car/instance_00004/instance.txt',
   'gm_8/Car/instance_00007/instance.txt',
   'gm_8/Car/instance_00003/instance.txt',
   'gm_8/Car/instance_00002/instance.txt',
   'gm_8/Duck/instance_00001/instance.txt',
   'gm_8/Duck/instance_00000/instance.txt',
   'gm_8/Duck/instance_00009/instance.txt',
   'gm_8/Duck/instance_00006/instance.txt',
   'gm_8/Duck/instance_00005/instance.txt',
   'gm_8/Duck/instance_00008/instance.txt',
   'gm_8/Duck/instance_00004/instance.txt',
   'gm_8/Duck/instance_00007/instance.txt',
   'gm_8/Duck/instance_00003/instance.txt',
   'gm_8/Duck/instance_00002/instance.txt',
   'gm_4/Face/instance_00001/instance.txt',
   'gm_4/Face/instance_00000/instance.txt',
   'gm_4/Face/instance_00009/instance.txt',
   'gm_4/Face/instance_00006/instance.txt',
   'gm_4/Face/instance_00005/instance.txt',
   'gm_4/Face/instance_00008/instance.txt',
   'gm_4/Face/instance_00004/instance.txt',
   'gm_4/Face/instance_00007/instance.txt',
   'gm_4/Face/instance_00003/instance.txt',
   'gm_4/Face/instance_00002/instance.txt',
   'gm_4/Winebottle/instance_00001/instance.txt',
   'gm_4/Winebottle/instance_00000/instance.txt',
   'gm_4/Winebottle/instance_00009/instance.txt',
   'gm_4/Winebottle/instance_00006/instance.txt',
   'gm_4/Winebottle/instance_00005/instance.txt',
   'gm_4/Winebottle/instance_00008/instance.txt',
   'gm_4/Winebottle/instance_00004/instance.txt',
   'gm_4/Winebottle/instance_00007/instance.txt',
   'gm_4/Winebottle/instance_00003/instance.txt',
   'gm_4/Winebottle/instance_00002/instance.txt',
   'gm_4/Motorbike/instance_00001/instance.txt',
   'gm_4/Motorbike/instance_00000/instance.txt',
   'gm_4/Motorbike/instance_00009/instance.txt',
   'gm_4/Motorbike/instance_00006/instance.txt',
   'gm_4/Motorbike/instance_00005/instance.txt',
   'gm_4/Motorbike/instance_00008/instance.txt',
   'gm_4/Motorbike/instance_00004/instance.txt',
   'gm_4/Motorbike/instance_00007/instance.txt',
   'gm_4/Motorbike/instance_00003/instance.txt',
   'gm_4/Motorbike/instance_00002/instance.txt',
   'gm_4/Car/instance_00001/instance.txt',
   'gm_4/Car/instance_00000/instance.txt',
   'gm_4/Car/instance_00009/instance.txt',
   'gm_4/Car/instance_00006/instance.txt',
   'gm_4/Car/instance_00005/instance.txt',
   'gm_4/Car/instance_00008/instance.txt',
   'gm_4/Car/instance_00004/instance.txt',
   'gm_4/Car/instance_00007/instance.txt',
   'gm_4/Car/instance_00003/instance.txt',
   'gm_4/Car/instance_00002/instance.txt',
   'gm_4/Duck/instance_00001/instance.txt',
   'gm_4/Duck/instance_00000/instance.txt',
   'gm_4/Duck/instance_00009/instance.txt',
   'gm_4/Duck/instance_00006/instance.txt',
   'gm_4/Duck/instance_00005/instance.txt',
   'gm_4/Duck/instance_00008/instance.txt',
   'gm_4/Duck/instance_00004/instance.txt',
   'gm_4/Duck/instance_00007/instance.txt',
   'gm_4/Duck/instance_00003/instance.txt',
   'gm_4/Duck/instance_00002/instance.txt',
   'gm_20/Face/instance_00001/instance.txt',
   'gm_20/Face/instance_00000/instance.txt',
   'gm_20/Face/instance_00004/instance.txt',
   'gm_20/Face/instance_00003/instance.txt',
   'gm_20/Face/instance_00002/instance.txt',
   'gm_20/Winebottle/instance_00001/instance.txt',
   'gm_20/Winebottle/instance_00000/instance.txt',
   'gm_20/Winebottle/instance_00004/instance.txt',
   'gm_20/Winebottle/instance_00003/instance.txt',
   'gm_20/Winebottle/instance_00002/instance.txt',
   'gm_20/Motorbike/instance_00001/instance.txt',
   'gm_20/Motorbike/instance_00000/instance.txt',
   'gm_20/Motorbike/instance_00004/instance.txt',
   'gm_20/Motorbike/instance_00003/instance.txt',
   'gm_20/Motorbike/instance_00002/instance.txt',
   'gm_20/Car/instance_00001/instance.txt',
   'gm_20/Car/instance_00000/instance.txt',
   'gm_20/Car/instance_00004/instance.txt',
   'gm_20/Car/instance_00003/instance.txt',
   'gm_20/Car/instance_00002/instance.txt',
   'gm_20/Duck/instance_00001/instance.txt',
   'gm_20/Duck/instance_00000/instance.txt',
   'gm_20/Duck/instance_00004/instance.txt',
   'gm_20/Duck/instance_00003/instance.txt',
   'gm_20/Duck/instance_00002/instance.txt',
   'gm_3/Face/instance_00001/instance.txt',
   'gm_3/Face/instance_00000/instance.txt',
   'gm_3/Face/instance_00009/instance.txt',
   'gm_3/Face/instance_00006/instance.txt',
   'gm_3/Face/instance_00005/instance.txt',
   'gm_3/Face/instance_00008/instance.txt',
   'gm_3/Face/instance_00004/instance.txt',
   'gm_3/Face/instance_00007/instance.txt',
   'gm_3/Face/instance_00003/instance.txt',
   'gm_3/Face/instance_00002/instance.txt',
   'gm_3/Winebottle/instance_00001/instance.txt',
   'gm_3/Winebottle/instance_00000/instance.txt',
   'gm_3/Winebottle/instance_00009/instance.txt',
   'gm_3/Winebottle/instance_00006/instance.txt',
   'gm_3/Winebottle/instance_00005/instance.txt',
   'gm_3/Winebottle/instance_00008/instance.txt',
   'gm_3/Winebottle/instance_00004/instance.txt',
   'gm_3/Winebottle/instance_00007/instance.txt',
   'gm_3/Winebottle/instance_00003/instance.txt',
   'gm_3/Winebottle/instance_00002/instance.txt',
   'gm_3/Motorbike/instance_00001/instance.txt',
   'gm_3/Motorbike/instance_00000/instance.txt',
   'gm_3/Motorbike/instance_00009/instance.txt',
   'gm_3/Motorbike/instance_00006/instance.txt',
   'gm_3/Motorbike/instance_00005/instance.txt',
   'gm_3/Motorbike/instance_00008/instance.txt',
   'gm_3/Motorbike/instance_00004/instance.txt',
   'gm_3/Motorbike/instance_00007/instance.txt',
   'gm_3/Motorbike/instance_00003/instance.txt',
   'gm_3/Motorbike/instance_00002/instance.txt',
   'gm_3/Car/instance_00001/instance.txt',
   'gm_3/Car/instance_00000/instance.txt',
   'gm_3/Car/instance_00009/instance.txt',
   'gm_3/Car/instance_00006/instance.txt',
   'gm_3/Car/instance_00005/instance.txt',
   'gm_3/Car/instance_00008/instance.txt',
   'gm_3/Car/instance_00004/instance.txt',
   'gm_3/Car/instance_00007/instance.txt',
   'gm_3/Car/instance_00003/instance.txt',
   'gm_3/Car/instance_00002/instance.txt',
   'gm_3/Duck/instance_00001/instance.txt',
   'gm_3/Duck/instance_00000/instance.txt',
   'gm_3/Duck/instance_00009/instance.txt',
   'gm_3/Duck/instance_00006/instance.txt',
   'gm_3/Duck/instance_00005/instance.txt',
   'gm_3/Duck/instance_00008/instance.txt',
   'gm_3/Duck/instance_00004/instance.txt',
   'gm_3/Duck/instance_00007/instance.txt',
   'gm_3/Duck/instance_00003/instance.txt',
   'gm_3/Duck/instance_00002/instance.txt',
   'gm_40/Face/instance_00001/instance.txt',
   'gm_40/Face/instance_00000/instance.txt',
   'gm_40/Winebottle/instance_00001/instance.txt',
   'gm_40/Winebottle/instance_00000/instance.txt',
   'gm_40/Motorbike/instance_00001/instance.txt',
   'gm_40/Motorbike/instance_00000/instance.txt',
   'gm_40/Car/instance_00001/instance.txt',
   'gm_40/Car/instance_00000/instance.txt',
   'gm_40/Duck/instance_00001/instance.txt',
   'gm_40/Duck/instance_00000/instance.txt',
   'gm_16/Face/instance_00001/instance.txt',
   'gm_16/Face/instance_00000/instance.txt',
   'gm_16/Face/instance_00004/instance.txt',
   'gm_16/Face/instance_00003/instance.txt',
   'gm_16/Face/instance_00002/instance.txt',
   'gm_16/Winebottle/instance_00001/instance.txt',
   'gm_16/Winebottle/instance_00000/instance.txt',
   'gm_16/Winebottle/instance_00004/instance.txt',
   'gm_16/Winebottle/instance_00003/instance.txt',
   'gm_16/Winebottle/instance_00002/instance.txt',
   'gm_16/Motorbike/instance_00001/instance.txt',
   'gm_16/Motorbike/instance_00000/instance.txt',
   'gm_16/Motorbike/instance_00004/instance.txt',
   'gm_16/Motorbike/instance_00003/instance.txt',
   'gm_16/Motorbike/instance_00002/instance.txt',
   'gm_16/Car/instance_00001/instance.txt',
   'gm_16/Car/instance_00000/instance.txt',
   'gm_16/Car/instance_00004/instance.txt',
   'gm_16/Car/instance_00003/instance.txt',
   'gm_16/Car/instance_00002/instance.txt',
   'gm_16/Duck/instance_00001/instance.txt',
   'gm_16/Duck/instance_00000/instance.txt',
   'gm_16/Duck/instance_00004/instance.txt',
   'gm_16/Duck/instance_00003/instance.txt',
   'gm_16/Duck/instance_00002/instance.txt',
   'gm_12/Face/instance_00001/instance.txt',
   'gm_12/Face/instance_00000/instance.txt',
   'gm_12/Face/instance_00009/instance.txt',
   'gm_12/Face/instance_00006/instance.txt',
   'gm_12/Face/instance_00005/instance.txt',
   'gm_12/Face/instance_00008/instance.txt',
   'gm_12/Face/instance_00004/instance.txt',
   'gm_12/Face/instance_00007/instance.txt',
   'gm_12/Face/instance_00003/instance.txt',
   'gm_12/Face/instance_00002/instance.txt',
   'gm_12/Winebottle/instance_00001/instance.txt',
   'gm_12/Winebottle/instance_00000/instance.txt',
   'gm_12/Winebottle/instance_00009/instance.txt',
   'gm_12/Winebottle/instance_00006/instance.txt',
   'gm_12/Winebottle/instance_00005/instance.txt',
   'gm_12/Winebottle/instance_00008/instance.txt',
   'gm_12/Winebottle/instance_00004/instance.txt',
   'gm_12/Winebottle/instance_00007/instance.txt',
   'gm_12/Winebottle/instance_00003/instance.txt',
   'gm_12/Winebottle/instance_00002/instance.txt',
   'gm_12/Motorbike/instance_00001/instance.txt',
   'gm_12/Motorbike/instance_00000/instance.txt',
   'gm_12/Motorbike/instance_00009/instance.txt',
   'gm_12/Motorbike/instance_00006/instance.txt',
   'gm_12/Motorbike/instance_00005/instance.txt',
   'gm_12/Motorbike/instance_00008/instance.txt',
   'gm_12/Motorbike/instance_00004/instance.txt',
   'gm_12/Motorbike/instance_00007/instance.txt',
   'gm_12/Motorbike/instance_00003/instance.txt',
   'gm_12/Motorbike/instance_00002/instance.txt',
   'gm_12/Car/instance_00001/instance.txt',
   'gm_12/Car/instance_00000/instance.txt',
   'gm_12/Car/instance_00009/instance.txt',
   'gm_12/Car/instance_00006/instance.txt',
   'gm_12/Car/instance_00005/instance.txt',
   'gm_12/Car/instance_00008/instance.txt',
   'gm_12/Car/instance_00004/instance.txt',
   'gm_12/Car/instance_00007/instance.txt',
   'gm_12/Car/instance_00003/instance.txt',
   'gm_12/Car/instance_00002/instance.txt',
   'gm_12/Duck/instance_00001/instance.txt',
   'gm_12/Duck/instance_00000/instance.txt',
   'gm_12/Duck/instance_00009/instance.txt',
   'gm_12/Duck/instance_00006/instance.txt',
   'gm_12/Duck/instance_00005/instance.txt',
   'gm_12/Duck/instance_00008/instance.txt',
   'gm_12/Duck/instance_00004/instance.txt',
   'gm_12/Duck/instance_00007/instance.txt',
   'gm_12/Duck/instance_00003/instance.txt',
   'gm_12/Duck/instance_00002/instance.txt'
   ]

for instance in instance_list:
   for algorithm in algorithms:
      instance_file = WILLOW_instance_dir + instance 
      output_dir = "WILLOW/" + os.path.dirname(instance) + "/"
      instance_name = os.path.splitext(os.path.basename(instance))[0]
      result_file = output_dir + instance_name + "_" + algorithm + "_result.txt"
      log_file = output_dir + instance_name + "_" + algorithm + "_log.txt"

      create_dir_cmd = "mkdir -p " + output_dir 
      call(create_dir_cmd, shell=True)
      print("optimize " + instance + " with " + algorithm)
      run_alg_cmd = "../" + algorithm + " -i " + instance_file + " -o " + result_file + " " + options + " 2>&1 > " + log_file
      call(run_alg_cmd, shell=True)
