#!/usr/bin/python
import os
import sys
sys.path.append('@EVAL_MODULE_PATH@')
import LPMP_evaluate_log

instance_list = [
   'synthetic/outlier/instance_6_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_3_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_8_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_7_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_9_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_2_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_4_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_10_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_5_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_9_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_8_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_7_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_6_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_3_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_2_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_5_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_10_nNodes_10_nGraphs_12.txt',
   'synthetic/outlier/instance_4_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_1_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_1_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_3_nNodes_10_nGraphs_12.txt',
   'synthetic/outlier/instance_2_nNodes_10_nGraphs_12.txt',
   'synthetic/outlier/instance_10_nNodes_10_nGraphs_16.txt',
   'synthetic/outlier/instance_1_nNodes_10_nGraphs_12.txt',
   'synthetic/outlier/instance_4_nNodes_10_nGraphs_12.txt',
   'synthetic/outlier/instance_7_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_2_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_5_nNodes_10_nGraphs_12.txt',
   'synthetic/outlier/instance_6_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_7_nNodes_10_nGraphs_12.txt',
   'synthetic/outlier/instance_3_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_6_nNodes_10_nGraphs_12.txt',
   'synthetic/outlier/instance_4_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_1_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_5_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_8_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_8_nNodes_10_nGraphs_12.txt',
   'synthetic/outlier/instance_9_nNodes_10_nGraphs_4.txt',
   'synthetic/outlier/instance_10_nNodes_10_nGraphs_8.txt',
   'synthetic/outlier/instance_9_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_5_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_8_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_9_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_1_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_4_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_9_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_10_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_8_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_4_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_5_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_10_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_7_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_6_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_3_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_2_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_3_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_6_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_2_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_7_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_1_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_3_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_8_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_2_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_9_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_1_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_4_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_1_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_5_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_4_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_7_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_5_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_6_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_2_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_7_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_10_nNodes_10_nGraphs_16.txt',
   'synthetic/complete/instance_3_nNodes_10_nGraphs_4.txt',
   'synthetic/complete/instance_6_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_8_nNodes_10_nGraphs_12.txt',
   'synthetic/complete/instance_10_nNodes_10_nGraphs_8.txt',
   'synthetic/complete/instance_9_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_2_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_8_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_3_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_1_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_9_nNodes_10_nGraphs_8.txt',
   'synthetic/deform/instance_1_nNodes_10_nGraphs_8.txt',
   'synthetic/deform/instance_4_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_5_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_4_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_6_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_5_nNodes_10_nGraphs_8.txt',
   'synthetic/deform/instance_10_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_7_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_2_nNodes_10_nGraphs_8.txt',
   'synthetic/deform/instance_7_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_3_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_6_nNodes_10_nGraphs_8.txt',
   'synthetic/deform/instance_9_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_10_nNodes_10_nGraphs_8.txt',
   'synthetic/deform/instance_8_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_5_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_1_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_4_nNodes_10_nGraphs_8.txt',
   'synthetic/deform/instance_9_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_8_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_9_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_8_nNodes_10_nGraphs_8.txt',
   'synthetic/deform/instance_10_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_5_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_4_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_6_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_10_nNodes_10_nGraphs_12.txt',
   'synthetic/deform/instance_7_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_3_nNodes_10_nGraphs_8.txt',
   'synthetic/deform/instance_6_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_2_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_3_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_1_nNodes_10_nGraphs_16.txt',
   'synthetic/deform/instance_2_nNodes_10_nGraphs_4.txt',
   'synthetic/deform/instance_7_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_10_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_1_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_5_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_1_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_4_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_3_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_2_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_7_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_6_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_9_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_4_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_8_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_10_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_5_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_8_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_3_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_6_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_9_nNodes_10_nGraphs_16.txt',
   'synthetic/density/instance_2_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_7_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_8_nNodes_10_nGraphs_12.txt',
   'synthetic/density/instance_8_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_10_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_9_nNodes_10_nGraphs_12.txt',
   'synthetic/density/instance_9_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_1_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_4_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_5_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_7_nNodes_10_nGraphs_12.txt',
   'synthetic/density/instance_2_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_7_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_6_nNodes_10_nGraphs_12.txt',
   'synthetic/density/instance_4_nNodes_10_nGraphs_12.txt',
   'synthetic/density/instance_3_nNodes_10_nGraphs_8.txt',
   'synthetic/density/instance_6_nNodes_10_nGraphs_4.txt',
   'synthetic/density/instance_5_nNodes_10_nGraphs_12.txt',
   'synthetic/density/instance_10_nNodes_10_nGraphs_12.txt',
   'synthetic/density/instance_1_nNodes_10_nGraphs_12.txt',
   'synthetic/density/instance_3_nNodes_10_nGraphs_12.txt',
   'synthetic/density/instance_2_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_8_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_9_nNodes_10_nGraphs_4.txt',
   'house/outlier/instance_1_nNodes_10_nGraphs_4.txt',
   'house/outlier/instance_4_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_10_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_8_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_5_nNodes_10_nGraphs_4.txt',
   'house/outlier/instance_9_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_3_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_2_nNodes_10_nGraphs_4.txt',
   'house/outlier/instance_7_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_2_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_3_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_6_nNodes_10_nGraphs_4.txt',
   'house/outlier/instance_1_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_4_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_10_nNodes_10_nGraphs_4.txt',
   'house/outlier/instance_5_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_7_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_6_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_4_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_5_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_5_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_1_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_4_nNodes_10_nGraphs_4.txt',
   'house/outlier/instance_7_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_6_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_3_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_2_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_9_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_8_nNodes_10_nGraphs_4.txt',
   'house/outlier/instance_1_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_10_nNodes_10_nGraphs_16.txt',
   'house/outlier/instance_8_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_9_nNodes_10_nGraphs_12.txt',
   'house/outlier/instance_10_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_3_nNodes_10_nGraphs_4.txt',
   'house/outlier/instance_6_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_2_nNodes_10_nGraphs_8.txt',
   'house/outlier/instance_7_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_4_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_6_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_3_nNodes_10_nGraphs_8.txt',
   'hotel/outlier/instance_10_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_10_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_5_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_7_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_6_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_7_nNodes_10_nGraphs_8.txt',
   'hotel/outlier/instance_2_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_3_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_2_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_1_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_9_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_8_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_8_nNodes_10_nGraphs_8.txt',
   'hotel/outlier/instance_9_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_5_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_4_nNodes_10_nGraphs_8.txt',
   'hotel/outlier/instance_1_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_7_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_2_nNodes_10_nGraphs_8.txt',
   'hotel/outlier/instance_6_nNodes_10_nGraphs_8.txt',
   'hotel/outlier/instance_3_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_8_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_10_nNodes_10_nGraphs_8.txt',
   'hotel/outlier/instance_9_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_4_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_1_nNodes_10_nGraphs_8.txt',
   'hotel/outlier/instance_3_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_2_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_5_nNodes_10_nGraphs_8.txt',
   'hotel/outlier/instance_1_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_8_nNodes_10_nGraphs_4.txt',
   'hotel/outlier/instance_4_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_10_nNodes_10_nGraphs_16.txt',
   'hotel/outlier/instance_5_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_7_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_6_nNodes_10_nGraphs_12.txt',
   'hotel/outlier/instance_9_nNodes_10_nGraphs_8.txt'
   ]

algorithms = ['multigraph_matching_mcf', 'multigraph_matching_tightening_mcf']

solver_options = "--standardReparametrization uniform --roundingReparametrization uniform:0.5 --tightenReparametrization uniform:0.5 --tightenInterval 50 --tightenIteration 300 --tightenConstraintsPercentage 0.05  --mcfReparametrization --primalComputationStart 1 --primalComputationInterval 50 -v 2 --lowerBoundComputationInterval 10 --tighten --multigraphMatchingOutputFormat clustering --multigraphMatchingRoundingMethod gaec_KL"

executable_dir = os.path.join("@CMAKE_CURRENT_BINARY_DIR@", "../")
instance_dir = "@HOTEL_HOUSE_SYNTHETIC_INSTANCE_DIRECTORY@"
output_dir = os.path.join("@CMAKE_CURRENT_BINARY_DIR@", "hotel_house_synthetic")

LPMP_evaluate_log.run_experiments(instance_list, algorithms, executable_dir, instance_dir, output_dir, solver_options)
#for instance in instance_list:
#   for algorithm in algorithms:
#      full_algorithm_path = current_dir + "../" + algorithm
#      instance_file = hotel_house_synthetic_instance_dir + instance 
#      output_dir = current_dir + "hotel_house_synthetic/" + os.path.dirname(instance) + "/"
#      instance_name = os.path.splitext(os.path.basename(instance))[0]
#      result_file = output_dir + instance_name + "_" + algorithm + "_result.txt"
#      log_file = output_dir + instance_name + "_" + algorithm + "_log.txt"
#
#      create_dir_cmd = "mkdir -p " + output_dir 
#      call(create_dir_cmd, shell=True)
#
#      if not (os.path.isfile(log_file) or os.path.isfile(result_file)):
#         print("optimize " + instance + " with " + algorithm)
#         run_alg_cmd = "export OMP_NUM_THREADS=1; " + full_algorithm_path + " -i " + instance_file + " -o " + result_file + " " + options + " 2>&1 > " + log_file
#         call(run_alg_cmd, shell=True)
#      else:
#         print("skip optimization of " + instance + " with algorithm " + algorithm)
